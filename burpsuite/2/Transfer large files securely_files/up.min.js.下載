function DragNDropHandler(e,t){var n,a,o=this;this.reset=function(){n=!1,a=0},e.ondragover=function(e){e.preventDefault(),o.reset()},e.ondrop=function(r){r.preventDefault(),$(e).hide(),o._scanItems(r.dataTransfer.items,function(e){e.file(function(e){n||(t.multiselector.addFile(e)||(n=!0),1==++a&&t.multiselector.installUploadControls())})})},this._scanItems=function(e,t){$(e).each(function(e,n){var a=n.webkitGetAsEntry?n.webkitGetAsEntry():n;a.isDirectory?a.createReader().readEntries(function(e){o._scanItems(e,t)},function(e){console.log("Error while reading directory:",e)}):a.isFile&&t&&t(a)})}}function MultiSelector(e,t,n){var a=this,o=[],r=n.ext_allowed?"."+n.ext_allowed.split(/\|/).join(",."):null;r&&$(t).attr("accept",r),this.addFile=function(r){var i=$("<div>"),s=$('<tr class="xrow"></tr>'),c=$('<td class="max-width-50">'),u=$('<font class="xfname tx-16 tx-bold mg-l-5">'),p=$('<font class="xfsize  mg-l-5">'),f=($(""),$('<input type="checkbox"  class="mg-r-10" value="1" name="file_public" title="Public folder"> ')),h=$(" "),m=$('<a href="#" title="Delete"><img class="" src="images/icon_delete.png"></a>');$(u).html(r.name),$(p).html("("+convertSize(r.size)+")");var v=o.length,_="pub_file_"+v.toString();return $(f).attr("id",_),$(h).attr("for",_),1==n.file_public_default&&$(f).attr("checked","true"),$(m).click(function(){$(i).remove(),o[v]=void 0,0==$.grep(o,function(e){return void 0!=e}).length&&($(t).parent().css("display",""),$("#file_0").get(0).value="",$("#upload_controls").remove(),$("#show_advanced").remove())}),n.max_upload_files>0&&$(e).find(".xrow").length>=n.max_upload_files?(alert("No remaining slots"),!1):!(!l(r)||!d(r))&&($(c).append(m,"&nbsp;",u,"&nbsp;",p,"&nbsp;",f),$(s).append(c),$(i).append(s),$(e).append(i),o.push(r),$(t).parent().css("display","none"),$(e).css("display",""),a.files_added++,!0)};var i=function(e){a.files_added=0,$(this.files).each(function(e,t){a.addFile(t)})},s=function(){var t=$('<div id="upload_controls">'),a=$('<br/><button type="button" name="upload"  class="btn btn-brand-02 bd-2 pd-x-30  btn-block btn-lg tx-bold" value="Start upload"><i class="fas fa-cloud-upload-alt"></i>  Upload</button>'),s=$(" "),l=$('<input type="file" class="d-none" id="add_more2">'),d=$('<div id="show_advanced" style="width: 485px;"></div>'),c=$("");d.append(c),$(c).click(function(){$("#advanced_opts").show(),$(this).hide()}),t.append(a),t.append(l),t.append(s),setTimeout(function(){$(l).css("left",$(s).position().left),$(l).css("position","absolute"),$(l).css("opacity",4)},0),$(a).click(function(e){var t=$.grep(o,function(e){return void 0!=e});n.oncomplete&&n.oncomplete(t),$("#show_advanced").hide(),$("#advanced_opts").hide(),e.preventDefault()}),$(l).change(i),r&&$(l).attr("accept",r),$(e).parent().append(d),$(e).parent().append(t)};this.installUploadControls=s;var l=function(e){if(""==e.name)return!0;var t=new RegExp("^.+.("+n.ext_allowed+")$","i"),a=new RegExp("^.+.("+n.ext_not_allowed+")$","i");return!(n.ext_allowed&&!t.test(e.name)||n.ext_not_allowed&&a.test(e.name))||(str="",n.ext_allowed&&(str+="\nOnly these extensions are allowed: "+n.ext_allowed.replace(/\|/g,",")),n.ext_not_allowed&&(str+="\nThese extensions are not allowed:"+n.ext_not_allowed.replace(/\|/g,",")),alert('Extension not allowed for file: "'+e.name+'"'+str),!1)},d=function(e){return""==e.name||(!n.max_upload_filesize||0==n.max_upload_filesize||(!(e.size>0&&e.size>1024*n.max_upload_filesize*1024)||(alert("File size limit is "+n.max_upload_filesize+" Mbytes"),!1)))};$(t).change(i),$(t).change(function(){a.files_added>0&&s()})}function convertSize(e){return e>1073741824?e=Math.round(e/1073741824*10)/10+" Gb":e>1048576?((e=Math.round(e/1048576*10)/10+"").match(/\./)||(e+=".0"),e+=" Mb"):e>1024?e=Math.round(e/1024*10)/10+" Kb":e+=" Bytes",e}function ProgressTracker(e,t){var n=$('<div class="progressbar-outer progress">'),a=$('<div class="progressbar-inner progress-bar progress-bar-striped active" role="progressbar"></div>'),o=$('<div class="progressbar-filenames">'),r=$('<div class="progressbar-completed">'),i=$('<div class="progressbar-speed">'),s=$('<a href="#">Abort</a>');t&&t.filenames&&$(o).html("<b>"+$.makeArray(t.filenames).join(", ")+"</b>"),$(i).html("Upload speed: <b>0 Kb/s</b>"),$(s).click(t.onabort?t.onabort:function(){document.location.reload()}),$(s).css("text-decoration","none"),$(n).append(a),$(e).append(n,"<br>",o,r,i,s);var l,d=0,c=0;this.update=function(t){var n=t.loaded/t.total;$(e).find(".progressbar-inner").css("width",Math.round(n*$(".progressbar-outer").width())),$(e).find(".progressbar-completed").html("<b>"+convertSize(t.loaded)+"</b> of <b>"+convertSize(t.total)+"</b>"),c=t.total,l||(l=Date.now());Date.now();$(e).find(".progressbar-speed").html("Upload speed: <b>"+convertSize(t.loaded-d)+"/s</b>"),d=t.loaded,l=Date.now()},this.finish=function(e,t){if(200==e.target.status){this.update({loaded:c,total:c});var n,a;try{a=e.target.responseText,n=JSON.parse(a.substring(a.lastIndexOf("\n")+1))}catch(e){alert("Error while parsing JSON:\n\n"+a)}var o=$(n).map(function(e,t){return"st="+t.file_status+"&fn="+t.file_code});this.link_rcpt&&o.push("link_rcpt="+this.link_rcpt),0!=n.length?document.location=t.return_url+o.toArray().join("&"):alert("None files uploaded")}},this.set_link_rcpt=function(e){this.link_rcpt=e}}function FileUploader(e,t){this.start=function(n){var a=formToXHR(e);$(n).each(function(e,t){a.fd.append("file_"+e.toString(),t)});var o=$(n).map(function(e,t){return t.name}),r=new ProgressTracker($(e).find(".progress_div"),{filenames:o}),i=$(e).get(0).link_rcpt;i&&r.set_link_rcpt(i.value),a.xhr.upload.addEventListener("progress",function(e){r.update(e)}),a.xhr.addEventListener("load",function(e){r.finish(e,t)}),$("#files_list").css("display","none"),$("#files_list2").css("display","none"),$("#upload_controls").css("display","none"),a.start()}}function URLUploader(e,t,n){this.start=function(){var a=$(e).get(0).url_mass.value;if(!a.match(/\S/))return alert("Enter one or more URLs to upload"),!1;var o=genUID(),r=formToXHR(e,$(e).attr("action")+"&upload_id="+o);$(".reurlupload form").hide();$(a.match(/[^\r\n]+/g)).map(function(e,t){var n=document.createElement("a");return n.href=t,n.pathname.split("/").slice(-1)[0]});var i=function(){r.xhr.abort(),$.ajax({url:$(e).attr("action")+"&kill="+o,success:function(){document.location.reload()}})},s=new ProgressTracker(t,{filenames:getFilenames(a),onabort:i});setInterval(function(){$.ajax({url:n.tmp_url+"/"+o+".json",dataType:"jsonp",jsonpCallback:"update_stat",success:function(e){s.update(e)}})},1e3),r.xhr.addEventListener("load",function(e){s.finish(e,n)}),r.start()}}function TorrentUploader(e){var t=formToXHR(e);t.xhr.addEventListener("load",function(){document.location="?op=my_files"}),this.start=t.start}function genUID(){for(var e="",t=0;t<12;t++)e+=""+Math.floor(10*Math.random());return e}function formToXHR(e,t){var n=new XMLHttpRequest;post_url=t||$(e).attr("action"),n.onerror=function(e){if("https:"!=document.location.protocol||post_url.match(/^https:/)){var t=e.target.status?e.target.statusText:"URL is not accessible";alert("Error while requesting "+post_url+":\n\n"+t)}else alert("Plain HTTP uploads are prohibited on HTTPS site by browser's security policies.\n\nPlease use your Admin Servers interface in order to switch file servers to HTTPS.")},n.addEventListener("load",function(e){200!=e.target.status&&alert(e.target.responseText)}),n.open("POST",post_url);var a=new FormData,o=serializeForm(e);return $(o).each(function(e,t){a.append(t.name,t.value)}),a.append("keepalive","1"),{xhr:n,fd:a,start:function(){n.send(a)}}}function serializeForm(e){var t=[];return $(e).find("input, select, textarea").each(function(e,n){"checkbox"==n.type?t.push({name:n.name,value:n.checked?n.value:""}):"file"==n.type||t.push({name:n.name,value:n.value})}),t}function convertSize(e){return e>1073741824?e=Math.round(e/1073741824*10)/10+" Gb":e>1048576?((e=Math.round(e/1048576*10)/10+"").match(/\./)||(e+=".0"),e+=" Mb"):e>1024?e=Math.round(e/1024*10)/10+" Kb":e+=" Bytes",e}function getFilenames(e){var t=e.split(/\n\r?/),n=[];return $(t).each(function(e,t){var a=document.createElement("a");a.href=t;var o=a.pathname.split("/");n.push(o[o.length-1])}),n}function $$(e){return document.getElementById(e)}function getFormAction(e){if(e){for(i=0;i<=e.attributes.length;i++)if(e.attributes[i]&&"action"==e.attributes[i].name.toLowerCase())return e.attributes[i].value;return""}}function setFormAction(e,t){for(i=0;i<=e.attributes.length;i++)e.attributes[i]&&"action"==e.attributes[i].name.toLowerCase()&&(e.attributes[i].value=t)}function InitUploadSelector(e,t,n){$$(e)&&new MultiSelector(e,n).addElement($$(t))}function findPos(e){var t=curtop=0;if(e.offsetParent)do{t+=e.offsetLeft,curtop+=e.offsetTop}while(e=e.offsetParent);return[t,curtop]}function changeUploadType(e){$$("div_file").style.position="absolute",$$("div_url")&&($$("div_url").style.position="absolute"),$$("div_rs")&&($$("div_rs").style.position="absolute"),$$("div_tt")&&($$("div_tt").style.position="absolute"),$$("div_ff")&&($$("div_ff").style.position="absolute"),$$("div_copy")&&($$("div_copy").style.position="absolute"),$$("div_"+e).style.position="static",$("#utmodes > input.active").removeClass("active"),$("#r_"+e).addClass("active")}